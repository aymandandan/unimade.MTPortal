@page
@using Microsoft.AspNetCore.Authorization
@using Volo.Abp.AspNetCore.Mvc.UI.Bootstrap.TagHelpers.Badge
@using Volo.Abp.MultiTenancy
@using unimade.MTPortal.Web.Menus
@using Volo.Abp.AspNetCore.Mvc.UI.Layout
@using Microsoft.AspNetCore.Mvc.Localization
@using unimade.MTPortal.Localization
@model unimade.MTPortal.Web.Pages.Internal.Dashboard.IndexModel
@inject ICurrentTenant CurrentTenant
@inject IHtmlLocalizer<MTPortalResource> L
@{
    ViewBag.PageTitle = "Dashboard";
}

@section styles {
    <abp-style src="/Pages/Internal/Dashboard/Index.css" />
}

@section scripts {
    <abp-script src="/Pages/Internal/Dashboard/Index.js" />
}

<abp-card>
    <abp-card-header class="bg-primary text-white">
        <abp-card-title>
            <i class="fas fa-tachometer-alt me-2"></i>
            @CurrentTenant.Name - @L["StaffDashboard"]
        </abp-card-title>
        <abp-card-subtitle>
            <small class="text-white-50">@L["LastUpdated"]: @DateTime.Now.ToString("MMM dd, yyyy hh:mm tt")</small>
        </abp-card-subtitle>
    </abp-card-header>

    <abp-card-body>
        <!-- Statistics Cards -->
        <div class="row g-3 mb-4">
            <!-- Public Users Count -->
            <div class="col-xl-3 col-md-6">
                <abp-card class="stat-card text-center border-0 shadow-sm">
                    <abp-card-body class="py-4">
                        <div class="stat-icon mb-3">
                            <i class="fas fa-users fa-2x text-primary"></i>
                        </div>
                        <h3 class="stat-number text-primary mb-2">@Model.DashboardStats.TotalPublicUsers</h3>
                        <p class="stat-label text-muted mb-3">@L["PublicUsers"]</p>
                        <abp-button size="Small"
                                    text="@L["ManageUsers"].Value"
                                    icon="fas fa-cog"
                                    button-type="Primary"
                                    onclick="location.href='/Internal/Users'" />
                    </abp-card-body>
                </abp-card>
            </div>

            <!-- Total Announcements -->
            <div class="col-xl-3 col-md-6">
                <abp-card class="stat-card text-center border-0 shadow-sm">
                    <abp-card-body class="py-4">
                        <div class="stat-icon mb-3">
                            <i class="fas fa-bullhorn fa-2x text-success"></i>
                        </div>
                        <h3 class="stat-number text-success mb-2">@Model.DashboardStats.TotalAnnouncements</h3>
                        <p class="stat-label text-muted mb-3">@L["TotalAnnouncements"]</p>
                        <abp-button size="Small"
                                    text="@L["ManageAnnouncements"].Value"
                                    icon="fas fa-cog"
                                    button-type="Success"
                                    onclick="location.href='/Internal/Announcements'" />
                    </abp-card-body>
                </abp-card>
            </div>

            <!-- Published Announcements -->
            <div class="col-xl-3 col-md-6">
                <abp-card class="stat-card text-center border-0 shadow-sm">
                    <abp-card-body class="py-4">
                        <div class="stat-icon mb-3">
                            <i class="fas fa-check-circle fa-2x text-info"></i>
                        </div>
                        <h3 class="stat-number text-info mb-2">@Model.DashboardStats.PublishedAnnouncements</h3>
                        <p class="stat-label text-muted mb-3">@L["Published"]</p>
                        <abp-badge badge-type="Success" text="@L["Live"].Value" />
                    </abp-card-body>
                </abp-card>
            </div>

            <!-- Draft Announcements -->
            <div class="col-xl-3 col-md-6">
                <abp-card class="stat-card text-center border-0 shadow-sm">
                    <abp-card-body class="py-4">
                        <div class="stat-icon mb-3">
                            <i class="fas fa-edit fa-2x text-warning"></i>
                        </div>
                        <h3 class="stat-number text-warning mb-2">@Model.DashboardStats.DraftAnnouncements</h3>
                        <p class="stat-label text-muted mb-3">@L["Drafts"]</p>
                        <abp-badge badge-type="Warning" text="@L["InProgress"].Value" />
                    </abp-card-body>
                </abp-card>
            </div>
        </div>

        <!-- Recent Activity & Quick Actions -->
        <div class="row g-4">
            <!-- Recent Announcements -->
            <div class="col-lg-8">
                <abp-card>
                    <abp-card-header class="d-flex justify-content-between align-items-center">
                        <abp-card-title>
                            <i class="fas fa-clock me-2 text-primary"></i>@L["RecentAnnouncements"]
                        </abp-card-title>
                        <abp-button size="Small"
                                    text="@L["ViewAll"].Value"
                                    button-type="Outline_Primary"
                                    onclick="location.href='/Internal/Announcements'" />
                    </abp-card-header>
                    <abp-card-body>
                        @if (Model.RecentAnnouncements.Any())
                        {
                            <div class="list-group list-group-flush">
                                @foreach (var announcement in Model.RecentAnnouncements)
                                {
                                    <div class="list-group-item px-0">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">@announcement.Title</h6>
                                                <p class="mb-1 text-muted small">
                                                    @announcement.Content.TruncateWithPostfix(100)
                                                </p>
                                                <small class="text-muted">
                                                    @L["CreationTime"]: @announcement.CreationTime.ToString("MMM dd, yyyy")
                                                    @if (announcement.PublishDate.HasValue)
                                                    {
                                                        <span class="ms-2">
                                                            @L["PublishDate"]: @announcement.PublishDate.Value.ToString("MMM dd, yyyy")
                                                        </span>
                                                    }
                                                </small>
                                            </div>
                                            <div class="ms-3">
                                                <abp-badge badge-type="@(announcement.IsPublished? AbpBadgeType.Success: AbpBadgeType.Warning)"
                                                           text="@(announcement.IsPublished? L["Published"].Value : L["Draft"].Value)" />
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-4">
                                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                <p class="text-muted">@L["NoAnnouncements"]</p>
                                <abp-button text="@L["CreateAnnouncement"].Value"
                                            button-type="Primary"
                                            onclick="location.href='/Internal/Announcements/Index'" />
                            </div>
                        }
                    </abp-card-body>
                </abp-card>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-4">
                <abp-card>
                    <abp-card-header>
                        <abp-card-title>
                            <i class="fas fa-bolt me-2 text-warning"></i>@L["QuickActions"]
                        </abp-card-title>
                    </abp-card-header>
                    <abp-card-body>
                        <div class="d-grid gap-2">
                            <abp-button text="@L["CreateNewAnnouncement"].Value"
                                        icon="fas fa-plus"
                                        button-type="Outline_Primary"
                                        onclick="createAnnouncement()" />

                            <abp-button text="@L["ViewPublicUsers"].Value"
                                        icon="fas fa-user-friends"
                                        button-type="Outline_Secondary"
                                        onclick="location.href='/Internal/Users/Index'" />

                            <abp-button text="@L["SystemSettings"].Value"
                                        icon="fas fa-cogs"
                                        button-type="Outline_Info"
                                        onclick="showSettings()" />
                        </div>

                        <!-- Tenant Info -->
                        <abp-card class="mt-4">
                            <abp-card-header>
                                <abp-card-title class="small">@L["TenantInformation"]</abp-card-title>
                            </abp-card-header>
                            <abp-card-body class="small">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>@L["Tenant"]:</strong>
                                    </div>
                                    <div class="col-6 text-end">
                                        @CurrentTenant.Name
                                    </div>
                                </div>
                                <div class="row mt-1">
                                    <div class="col-6">
                                        <strong>ID:</strong>
                                    </div>
                                    <div class="col-6 text-end">
                                        <small class="text-muted">@CurrentTenant.Id?.ToString().TruncateWithPostfix(8)...</small>
                                    </div>
                                </div>
                                <div class="row mt-1">
                                    <div class="col-6">
                                        <strong>@L["LastActivity"]:</strong>
                                    </div>
                                    <div class="col-6 text-end">
                                        <small class="text-muted">@Model.DashboardStats.LastAnnouncementDate?.ToString("MMM dd")</small>
                                    </div>
                                </div>
                            </abp-card-body>
                        </abp-card>
                    </abp-card-body>
                </abp-card>
            </div>
        </div>
    </abp-card-body>
</abp-card>